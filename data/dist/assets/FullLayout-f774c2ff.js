import{d as ve,o as m,c as T,a as be,w as t,b as e,V as me,e as r,t as S,f as M,g as B,h as _e,i as ge,j as pe,s as ye,r as u,k as we,l as E,m as k,n as xe,F as te,p as Ve,q as l,u as i,v as p,x as fe,y as G,z as ke,A as Se,B as R,C as he,D as J,E as ae,G as oe,H as le,I as Z,J as K,K as Q,L as Ce,M as Te,N as V,O as se,P as Ie,Q as ie,R as ne,S as F,T as ze,U as de,W as re,X as Ee,Y as Be,Z as De,_ as Le,$ as ue,a0 as Ae,a1 as Re,a2 as Me,a3 as Ue,a4 as We}from"./index-11f1cd8c.js";import{m as ce}from"./md5-3d759a08.js";import{u as $e}from"./common-34a2a7ab.js";const j={Sidebar_drawer:!0,Customizer_drawer:!1,mini_sidebar:!1,fontTheme:"Roboto",inputBg:!1},ee=ve({id:"customizer",state:()=>({Sidebar_drawer:j.Sidebar_drawer,Customizer_drawer:j.Customizer_drawer,mini_sidebar:j.mini_sidebar,fontTheme:"Poppins",inputBg:j.inputBg}),getters:{},actions:{SET_SIDEBAR_DRAWER(){this.Sidebar_drawer=!this.Sidebar_drawer},SET_MINI_SIDEBAR(d){this.mini_sidebar=d},SET_FONT(d){this.fontTheme=d}}}),He=[{title:"统计",icon:"mdi-view-dashboard",to:"/dashboard/default"},{title:"消息平台",icon:"mdi-message-processing",to:"/platforms"},{title:"服务提供商",icon:"mdi-creation",to:"/providers"},{title:"配置",icon:"mdi-cog",to:"/config"},{title:"插件管理",icon:"mdi-puzzle",to:"/extension"},{title:"插件市场",icon:"mdi-storefront",to:"/extension-marketplace"},{title:"聊天",icon:"mdi-chat",to:"/chat"},{title:"控制台",icon:"mdi-console",to:"/console"},{title:"设置",icon:"mdi-wrench",to:"/settings"},{title:"关于",icon:"mdi-information",to:"/about"}],Ne={__name:"NavItem",props:{item:Object,level:Number},setup(d){return(f,h)=>(m(),T(pe,{to:d.item.type==="external"?"":d.item.to,href:d.item.type==="external"?d.item.to:"",rounded:"",class:"mb-1",color:"secondary",disabled:d.item.disabled,target:d.item.type==="external"?"_blank":""},be({prepend:t(()=>[d.item.icon?(m(),T(M,{key:0,size:d.item.iconSize,class:"hide-menu",icon:d.item.icon},null,8,["size","icon"])):B("",!0)]),default:t(()=>[e(_e,{style:{"font-size":"15px"}},{default:t(()=>[r(S(d.item.title),1)]),_:1}),d.item.subCaption?(m(),T(ge,{key:0,class:"text-caption mt-n1 hide-menu"},{default:t(()=>[r(S(d.item.subCaption),1)]),_:1})):B("",!0)]),_:2},[d.item.chip?{name:"append",fn:t(()=>[e(me,{color:d.item.chipColor,class:"sidebarchip hide-menu",size:d.item.chipIcon?"small":"default",variant:d.item.chipVariant,"prepend-icon":d.item.chipIcon},{default:t(()=>[r(S(d.item.chip),1)]),_:1},8,["color","size","variant","prepend-icon"])]),key:"0"}:void 0]),1032,["to","href","disabled","target"]))}},Pe={class:"text-center"},Xe={style:{position:"absolute",bottom:"32px",width:"100%","font-size":"13px"},class:"text-center"},Ye={key:1,style:{display:"block"}},qe={key:2,style:{display:"block"}},Fe=l("small",{style:{display:"block","margin-top":"8px"}},"AGPL-3.0",-1),je={style:{display:"flex","align-items":"center"}},Ge=l("span",{style:{"margin-left":"8px"}},"拖拽",-1),Oe={style:{display:"flex",gap:"8px"}},Je=l("iframe",{src:"https://astrbot.app",style:{width:"100%",height:"calc(100% - 56px)",border:"none","border-bottom-left-radius":"12px","border-bottom-right-radius":"12px"}},null,-1),Ke={__name:"VerticalSidebar",setup(d){const f=ee(),h=ye(He),I=u(!1),w=u(""),v=u(""),_=u(!1),x=u({position:"fixed",bottom:"16px",right:"16px",width:"490px",height:"640px",minWidth:"300px",minHeight:"200px",background:"white",resize:"both",overflow:"auto",zIndex:"10000000",borderRadius:"12px",boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.1)"});window.innerWidth<768&&(x.value={position:"fixed",top:"10%",left:"0%",width:"100%",height:"50%",minWidth:"300px",minHeight:"200px",background:"white",resize:"both",overflow:"auto",zIndex:"1002",borderRadius:"12px",boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.1)"},f.Sidebar_drawer=!1);const D={width:"100%",padding:"8px",background:"#f0f0f0",borderBottom:"1px solid #ccc",borderTopLeftRadius:"8px",borderTopRightRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"move"};function g(){I.value=!I.value}function U(){typeof window<"u"&&window.open("https://astrbot.app","_blank")}let W=0,L=0,z=!1;function C(n,c,b){return Math.min(Math.max(n,c),b)}function $(n,c){z=!0;const o=document.getElementById("draggable-iframe").getBoundingClientRect();W=n-o.left,L=c-o.top,document.body.style.userSelect="none",document.addEventListener("mousemove",A),document.addEventListener("mouseup",y),document.addEventListener("touchmove",P,{passive:!1}),document.addEventListener("touchend",H)}function N(n){$(n.clientX,n.clientY)}function A(n){z&&X(n.clientX,n.clientY)}function y(){Y()}function O(n){if(n.touches.length===1){const c=n.touches[0];$(c.clientX,c.clientY)}}function P(n){if(z&&n.touches.length===1){n.preventDefault();const c=n.touches[0];X(c.clientX,c.clientY)}}function H(){Y()}function X(n,c){const b=document.getElementById("draggable-iframe"),o=C(n-W,0,window.innerWidth-b.offsetWidth),a=C(c-L,0,window.innerHeight-b.offsetHeight);x.value.left=o+"px",x.value.top=a+"px"}function Y(){z=!1,document.body.style.userSelect="",document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",y),document.removeEventListener("touchmove",P),document.removeEventListener("touchend",H)}return we(()=>{E.get("/api/stat/version").then(n=>{w.value="v"+n.data.data.version}).catch(n=>{console.log(n)}),E.get("/api/update/check?type=dashboard").then(n=>{_.value=n.data.data.has_new_version,v.value=n.data.data.current_version}).catch(n=>{console.log(n)})}),(n,c)=>(m(),k(te,null,[e(ke,{left:"",modelValue:i(f).Sidebar_drawer,"onUpdate:modelValue":c[0]||(c[0]=b=>i(f).Sidebar_drawer=b),elevation:"0","rail-width":"80",app:"",class:"leftSidebar",width:"220",rail:i(f).mini_sidebar},{default:t(()=>[e(xe,{class:"pa-4 listitem",style:{height:"auto"}},{default:t(()=>[(m(!0),k(te,null,Ve(h.value,(b,o)=>(m(),T(Ne,{key:o,item:b,class:"leftPadding"},null,8,["item"]))),128))]),_:1}),l("div",Pe,[e(me,{color:"inputBorder",size:"small"},{default:t(()=>[r(S(w.value),1)]),_:1})]),l("div",Xe,[i(f).mini_sidebar?B("",!0):(m(),T(pe,{key:0,onClick:g},{default:t(()=>[e(p,{variant:"plain",size:"small"},{default:t(()=>[r(" 🤔 点击此处 查看/关闭 悬浮文档！ ")]),_:1})]),_:1})),v.value?(m(),k("small",Ye,"WebUI 版本: "+S(v.value),1)):(m(),k("small",qe,"构建: embedded")),e(fe,{text:"使用 /dashboard_update 指令更新管理面板"},{activator:t(({props:b})=>[_.value?(m(),k("small",G({key:0},b,{style:{display:"block","margin-top":"4px"}}),"面板有更新",16)):B("",!0)]),_:1}),Fe])]),_:1},8,["modelValue","rail"]),I.value?(m(),k("div",{key:0,id:"draggable-iframe",style:Se(x.value)},[l("div",{style:D,onMousedown:N,onTouchstart:O},[l("div",je,[e(M,{icon:"mdi-cursor-move"}),Ge]),l("div",Oe,[e(p,{icon:"",onClick:R(U,["stop"]),onMousedown:c[1]||(c[1]=R(()=>{},["stop"])),style:{"border-radius":"8px",border:"1px solid #ccc"}},{default:t(()=>[e(M,{icon:"mdi-open-in-new"})]),_:1},8,["onClick"]),e(p,{icon:"",onClick:R(g,["stop"]),onMousedown:c[2]||(c[2]=R(()=>{},["stop"])),style:{"border-radius":"8px",border:"1px solid #ccc"}},{default:t(()=>[e(M,{icon:"mdi-close"})]),_:1},8,["onClick"])])],32),Je],4)):B("",!0)],64))}},Qe=l("span",{style:{"margin-left":"16px","font-size":"24px","font-weight":"1000"}},[r("Astr"),l("span",{style:{"font-weight":"normal"}},"Bot")],-1),Ze={class:"mr-4"},et={key:0},tt=l("span",{class:"text-h5"},"更新 AstrBot",-1),at={style:{display:"inline-block"}},ot={style:{"margin-left":"4px"}},lt=l("div",{class:"mb-4 mt-4"},[l("small",null,[r("💡 TIP: 跳到旧版本或者切换到某个版本不会重新下载管理面板文件，这可能会造成部分数据显示错误。您可在 "),l("a",{href:"https://github.com/Soulter/AstrBot/releases"},"此处"),r(" 找到对应的面板文件 dist.zip，解压后替换 data/dist 文件夹即可。当然，前端源代码在 dashboard 目录下，你也可以自己使用 npm install 和 npm build 构建。")])],-1),st=l("div",{class:"mb-4"},[l("small",null,[r("`更新到最新版本` 按钮会同时尝试更新机器人主程序和管理面板。如果您正在使用 Docker 部署，也可以重新拉取镜像或者使用 "),l("a",{href:"https://containrrr.dev/watchtower/usage-overview/"},"watchtower"),r(" 来自动监控拉取。")])],-1),it={style:{"margin-top":"16px"}},nt=l("h3",{class:"mb-4"},"手动输入版本号或 Commit SHA",-1),dt=l("div",{class:"mb-4"},[l("small",null,"如 v3.3.16 (不带 SHA) 或 42e5ec5d80b93b6bfe8b566754d45ffac4c3fe0b"),l("br"),l("a",{href:"https://github.com/Soulter/AstrBot/commits/master"},[l("small",null,"查看 master 分支提交记录（点击右边的 copy 即可复制）")])],-1),rt={style:{"margin-top":"16px"}},ut=l("h3",{class:"mb-4"},"单独更新管理面板到最新版本",-1),ct={class:"mb-4"},mt=l("br",null,null,-1),pt={class:"mb-4"},ft={key:0},ht={key:1},vt=l("span",{class:"text-h5"},"账户",-1),bt=l("div",null,"为了安全，请尽快修改默认密码。",-1),_t=l("small",null,"默认用户名和密码是 astrbot。",-1),gt=l("br",null,null,-1),yt=he({__name:"VerticalHeader",setup(d){const f=ee();let h=u(!1),I=u(!1),w=u(!1),v=u(""),_=u(""),x=u(""),D=u(""),g=u(""),U=u(!1),W=u(""),L=u(!1),z=u(""),C=u(""),$=u([]),N=u([]),A=u(!1),y=u(0),O=[{title:"标签",key:"tag_name"},{title:"发布时间",key:"published_at"},{title:"内容",key:"body"},{title:"源码地址",key:"zipball_url"},{title:"操作",key:"switch"}];function P(){v.value!=""&&(v.value=ce.md5(v.value)),_.value!=""&&(_.value=ce.md5(_.value)),E.post("/api/auth/account/edit",{password:v.value,new_password:_.value,new_username:x.value}).then(o=>{if(o.data.status=="error"){D.value=o.data.message,v.value="",_.value="";return}h.value=!h.value,D.value=o.data.message,setTimeout(()=>{ue().logout()},1e3)}).catch(o=>{console.log(o),D.value=o,v.value="",_.value=""})}function H(){g.value="正在检查更新...",E.get("/api/update/check").then(o=>{U.value=o.data.data.has_new_version,g.value=o.data.message,W.value=o.data.data.version,z.value=o.data.data.dashboard_version,L.value=o.data.data.dashboard_has_new_version}).catch(o=>{if(o.response.status==401){console.log("401"),ue().logout();return}console.log(o),g.value=o})}function X(){E.get("/api/update/releases").then(o=>{$.value=o.data.data.map(a=>(a.published_at=new Date(a.published_at).toLocaleString(),a))}).catch(o=>{console.log(o)})}function Y(){fetch("https://api.github.com/repos/Soulter/AstrBot/commits",{headers:{Host:"api.github.com",Referer:"https://api.github.com"}}).then(o=>o.json()).then(o=>{N.value=o.map(a=>({sha:a.sha,date:new Date(a.commit.author.date).toLocaleString(),message:a.commit.message}))}).catch(o=>{console.log(o)})}function n(o){g.value="正在切换版本...",A.value=!0,E.post("/api/update/do",{version:o,proxy:localStorage.getItem("selectedGitHubProxy")||""}).then(a=>{g.value=a.data.message,a.data.status=="ok"&&setTimeout(()=>{window.location.reload()},1e3)}).catch(a=>{console.log(a),g.value=a}).finally(()=>{A.value=!1})}function c(){g.value="正在更新...",E.post("/api/update/dashboard").then(o=>{g.value=o.data.message,o.data.status=="ok"&&setTimeout(()=>{window.location.reload()},1e3)}).catch(o=>{console.log(o),g.value=o})}H();const b=$e();return b.createWebSocket(),b.getStartTime(),localStorage.getItem("change_pwd_hint")!=null&&localStorage.getItem("change_pwd_hint")=="true"&&(h.value=!0,I.value=!0,localStorage.removeItem("change_pwd_hint")),(o,a)=>(m(),T(Le,{elevation:"0",height:"55"},{default:t(()=>[e(p,{style:{"margin-left":"22px"},class:"hidden-md-and-down text-secondary",color:"lightsecondary",icon:"",rounded:"sm",variant:"flat",onClick:a[0]||(a[0]=R(s=>i(f).SET_MINI_SIDEBAR(!i(f).mini_sidebar),["stop"])),size:"small"},{default:t(()=>[e(M,null,{default:t(()=>[r("mdi-menu")]),_:1})]),_:1}),e(p,{class:"hidden-lg-and-up text-secondary ms-3",color:"lightsecondary",icon:"",rounded:"sm",variant:"flat",onClick:R(i(f).SET_SIDEBAR_DRAWER,["stop"]),size:"small"},{default:t(()=>[e(M,null,{default:t(()=>[r("mdi-menu")]),_:1})]),_:1},8,["onClick"]),Qe,e(J),l("div",Ze,[i(U)?(m(),k("small",et," 有新版本！ ")):B("",!0)]),e(re,{modelValue:i(w),"onUpdate:modelValue":a[9]||(a[9]=s=>V(w)?w.value=s:w=s),width:"1000"},{activator:t(({props:s})=>[e(p,G({onClick:a[1]||(a[1]=q=>{H(),X(),Y()}),class:"text-primary mr-4",color:"lightprimary",variant:"flat",rounded:"sm"},s),{default:t(()=>[r(" 更新 🔄 ")]),_:2},1040)]),default:t(()=>[e(ae,null,{default:t(()=>[e(oe,null,{default:t(()=>[tt]),_:1}),e(le,null,{default:t(()=>[e(Z,null,{default:t(()=>[K(e(Ce,{class:"mb-4",indeterminate:"",color:"primary"},null,512),[[Q,i(A)]]),l("div",null,[l("h1",at,S(i(W)),1),l("small",ot,S(i(g)),1)]),lt,e(Te,{modelValue:i(y),"onUpdate:modelValue":a[2]||(a[2]=s=>V(y)?y.value=s:y=s)},{default:t(()=>[e(se,{value:"0"},{default:t(()=>[r("😊 正式版")]),_:1}),e(se,{value:"1"},{default:t(()=>[r("🧐 开发版(master 分支)")]),_:1})]),_:1},8,["modelValue"]),e(Ie,{modelValue:i(y),"onUpdate:modelValue":a[4]||(a[4]=s=>V(y)?y.value=s:y=s)},{default:t(()=>[K(e(ie,{key:"0"},{default:t(()=>[e(p,{class:"mt-4 mb-4",onClick:a[3]||(a[3]=s=>n("latest")),color:"primary",style:{"border-radius":"10px"},disabled:!i(U)},{default:t(()=>[r(" 更新到最新版本 ")]),_:1},8,["disabled"]),st,e(ne,{headers:i(O),items:i($),"item-key":"name"},{"item.body":t(({item:s})=>[e(fe,{text:s.body},{activator:t(({props:q})=>[e(p,G(q,{rounded:"xl",variant:"tonal",color:"primary",size:"small"}),{default:t(()=>[r("查看")]),_:2},1040)]),_:2},1032,["text"])]),"item.switch":t(({item:s})=>[e(p,{onClick:q=>n(s.tag_name),rounded:"xl",variant:"plain",color:"primary"},{default:t(()=>[r(" 切换 ")]),_:2},1032,["onClick"])]),_:1},8,["headers","items"])]),_:1},512),[[Q,i(y)==0]]),K(e(ie,{key:"1"},{default:t(()=>[l("div",it,[e(ne,{headers:[{title:"SHA",key:"sha"},{title:"日期",key:"date"},{title:"信息",key:"message"},{title:"操作",key:"switch"}],items:i(N),"item-key":"sha"},{"item.switch":t(({item:s})=>[e(p,{onClick:q=>n(s.sha),rounded:"xl",variant:"plain",color:"primary"},{default:t(()=>[r(" 切换 ")]),_:2},1032,["onClick"])]),_:1},8,["items"])])]),_:1},512),[[Q,i(y)==1]])]),_:1},8,["modelValue"]),nt,e(F,{label:"输入版本号或 master 分支下的 commit hash。",modelValue:i(C),"onUpdate:modelValue":a[5]||(a[5]=s=>V(C)?C.value=s:C=s),required:"",variant:"outlined"},null,8,["modelValue"]),dt,e(p,{color:"error",style:{"border-radius":"10px"},onClick:a[6]||(a[6]=s=>n(i(C)))},{default:t(()=>[r(" 确定切换 ")]),_:1}),e(ze,{class:"mt-4 mb-4"}),l("div",rt,[ut,l("div",ct,[l("small",null,"当前版本 "+S(i(z)),1),mt]),l("div",pt,[i(L)?(m(),k("p",ft," 有新版本！ ")):(m(),k("p",ht," 已经是最新版本了。 "))]),e(p,{color:"primary",style:{"border-radius":"10px"},onClick:a[7]||(a[7]=s=>c()),disabled:!i(L)},{default:t(()=>[r(" 下载并更新 ")]),_:1},8,["disabled"])])]),_:1})]),_:1}),e(de,null,{default:t(()=>[e(J),e(p,{color:"blue-darken-1",variant:"text",onClick:a[8]||(a[8]=s=>V(w)?w.value=!1:w=!1)},{default:t(()=>[r(" 关闭 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(re,{modelValue:i(h),"onUpdate:modelValue":a[14]||(a[14]=s=>V(h)?h.value=s:h=s),persistent:"",width:"700"},{activator:t(({props:s})=>[e(p,G({class:"text-primary mr-4",color:"lightprimary",variant:"flat",rounded:"sm"},s),{default:t(()=>[r(" 账户 📰 ")]),_:2},1040)]),default:t(()=>[e(ae,null,{default:t(()=>[e(oe,null,{default:t(()=>[vt]),_:1}),e(le,null,{default:t(()=>[e(Z,null,{default:t(()=>[e(Ee,null,{default:t(()=>[e(Be,{cols:"12"},{default:t(()=>[i(I)?(m(),T(De,{key:0,color:"warning",style:{"margin-bottom":"16px"}},{default:t(()=>[bt]),_:1})):B("",!0),e(F,{label:"原密码*",type:"password",modelValue:i(v),"onUpdate:modelValue":a[10]||(a[10]=s=>V(v)?v.value=s:v=s),required:"",variant:"outlined"},null,8,["modelValue"]),e(F,{label:"新用户名",modelValue:i(x),"onUpdate:modelValue":a[11]||(a[11]=s=>V(x)?x.value=s:x=s),required:"",variant:"outlined"},null,8,["modelValue"]),e(F,{label:"新密码",type:"password",modelValue:i(_),"onUpdate:modelValue":a[12]||(a[12]=s=>V(_)?_.value=s:_=s),required:"",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),_t,gt,l("small",null,S(i(D)),1)]),_:1}),e(de,null,{default:t(()=>[e(J),e(p,{color:"blue-darken-1",variant:"text",onClick:a[13]||(a[13]=s=>V(h)?h.value=!1:h=!1)},{default:t(()=>[r(" 关闭 ")]),_:1}),e(p,{color:"blue-darken-1",variant:"text",onClick:P},{default:t(()=>[r(" 提交 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),wt={style:{height:"100%"}},St=he({__name:"FullLayout",setup(d){const f=ee();return(h,I)=>(m(),T(Ue,null,{default:t(()=>[e(Me,{theme:"PurpleTheme",class:Re([i(f).fontTheme,i(f).mini_sidebar?"mini-sidebar":"",i(f).inputBg?"inputWithbg":""])},{default:t(()=>[e(yt),e(Ke),e(Ae,null,{default:t(()=>[e(Z,{fluid:"",class:"page-wrapper",style:{height:"calc(100% - 8px)"}},{default:t(()=>[l("div",wt,[e(i(We))])]),_:1})]),_:1})]),_:1},8,["class"])]),_:1}))}});export{St as default};
