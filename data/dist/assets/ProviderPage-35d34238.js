import{l as g,a5 as p,o as n,m as c,b as e,w as s,E as h,a9 as P,F as v,H as C,af as F,v as u,y as z,f as w,e as i,n as A,p as y,X as M,W as T,G as V,q as m,t as r,U as k,D as U,g as x,c as S,j as W,h as j,Y as I,ag as L,V as b}from"./index-11f1cd8c.js";import{A as R}from"./AstrBotConfig-568869c1.js";import{W as E}from"./WaitingForRestart-0476b659.js";import{_ as q}from"./ConsoleDisplayer-9b3eae3d.js";import{_ as G}from"./_plugin-vue_export-helper-c27b6911.js";import"./common-34a2a7ab.js";const H={name:"ProviderPage",components:{AstrBotConfig:R,WaitingForRestart:E,ConsoleDisplayer:q},data(){return{config_data:{},fetched:!1,metadata:{},showproviderCfg:!1,newSelectedproviderName:"",newSelectedproviderConfig:{},updatingMode:!1,loading:!1,save_message_snack:!1,save_message:"",save_message_success:"",showConsole:!1}},mounted(){this.getConfig()},methods:{getConfig(){g.get("/api/config/get").then(t=>{this.config_data=t.data.data.config,this.fetched=!0,this.metadata=t.data.data.metadata}).catch(t=>{save_message=t,save_message_snack=!0,save_message_success="error"})},addFromDefaultConfigTmpl(t){console.log(t),this.newSelectedproviderName=t[0],this.showproviderCfg=!0,this.updatingMode=!1,this.newSelectedproviderConfig=this.metadata.provider_group.metadata.provider.config_template[t[0]]},newprovider(){this.loading=!0,this.updatingMode?(g.post("/api/config/provider/update",{id:this.newSelectedproviderName,config:this.newSelectedproviderConfig}).then(t=>{this.loading=!1,this.showproviderCfg=!1,this.getConfig(),this.save_message=t.data.message,this.save_message_snack=!0,this.save_message_success="success"}).catch(t=>{this.loading=!1,this.save_message=t,this.save_message_snack=!0,this.save_message_success="error"}),this.updatingMode=!1):g.post("/api/config/provider/new",this.newSelectedproviderConfig).then(t=>{this.loading=!1,this.showproviderCfg=!1,this.getConfig()}).catch(t=>{this.loading=!1,this.save_message=t,this.save_message_snack=!0,this.save_message_success="error"})},deleteprovider(t){g.post("/api/config/provider/delete",{id:t}).then(l=>{this.getConfig(),this.save_message=l.data.message,this.save_message_snack=!0,this.save_message_success="success"}).catch(l=>{this.save_message=l,this.save_message_snack=!0,this.save_message_success="error"})},providerStatusChange(t){g.post("/api/config/provider/update",{id:t.id,config:t}).then(l=>{this.getConfig(),this.save_message=l.data.message,this.save_message_snack=!0,this.save_message_success="success"}).catch(l=>{this.save_message=l,this.save_message_snack=!0,this.save_message_success="error"})}}},K={class:"text-h4"},X=m("span",{style:{"font-size":"12px"}},"适配器类型: ",-1),Y={key:0,style:{"margin-top":"8px"}},J=m("span",{style:{"font-size":"12px"}},"API Base: ",-1),O={class:"text-h4"},Q={key:0,style:{"margin-top":"32px"}};function Z(t,l,$,ee,o,_){const B=p("AstrBotConfig"),N=p("ConsoleDisplayer"),D=p("WaitingForRestart");return n(),c(v,null,[e(h,{style:{height:"100%"}},{default:s(()=>[e(C,{style:{padding:"32px",height:"100%"}},{default:s(()=>[e(F,null,{activator:s(({props:a})=>[e(u,z({class:"flex-grow-1",variant:"tonal",onClick:l[0]||(l[0]=d=>t.new_provider_dialog=!0),size:"large",rounded:"lg"},a,{color:"primary"}),{default:s(()=>[e(w,null,{default:s(()=>[i("mdi-plus")]),_:1}),i(" 新增服务提供商 ")]),_:2},1040)]),default:s(()=>[e(A,{"onUpdate:selected":l[1]||(l[1]=a=>_.addFromDefaultConfigTmpl(a))},{default:s(()=>[(n(!0),c(v,null,y(o.metadata.provider_group.metadata.provider.config_template,(a,d)=>(n(),S(W,{key:d,rounded:"xl",value:d},{default:s(()=>[e(j,null,{default:s(()=>[i(r(d),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})]),_:1}),e(M,{style:{"margin-top":"16px"}},{default:s(()=>[(n(!0),c(v,null,y(o.config_data.provider,(a,d)=>(n(),S(I,{key:d,cols:"12",md:"6",lg:"3"},{default:s(()=>[e(h,{class:"fade-in",style:{"margin-bottom":"16px","min-height":"250px","max-height":"250px",display:"flex","justify-content":"space-between","flex-direction":"column"}},{default:s(()=>[e(V,{class:"d-flex justify-space-between align-center"},{default:s(()=>[m("span",K,r(a.id),1),e(L,{color:"primary","hide-details":"",density:"compact",modelValue:a.enable,"onUpdate:modelValue":[f=>a.enable=f,f=>_.providerStatusChange(a)]},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(C,null,{default:s(()=>[m("div",null,[X,i(),e(b,{size:"small",color:"primary",text:""},{default:s(()=>[i(r(a.type),1)]),_:2},1024)]),a!=null&&a.api_base?(n(),c("div",Y,[J,i(),e(b,{size:"small",color:"primary",text:""},{default:s(()=>[i(r(a==null?void 0:a.api_base),1)]),_:2},1024)])):x("",!0)]),_:2},1024),e(k,{class:"d-flex justify-end"},{default:s(()=>[e(u,{color:"error",text:"",onClick:f=>{_.deleteprovider(a.id)}},{default:s(()=>[i(" 删除 ")]),_:2},1032,["onClick"]),e(u,{color:"blue-darken-1",text:"",onClick:f=>{o.updatingMode=!0,o.showproviderCfg=!0,o.newSelectedproviderConfig=a,o.newSelectedproviderName=a.id}},{default:s(()=>[i(" 配置 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(T,{modelValue:o.showproviderCfg,"onUpdate:modelValue":l[2]||(l[2]=a=>o.showproviderCfg=a),width:"700"},{default:s(()=>[e(h,null,{default:s(()=>[e(V,null,{default:s(()=>[m("span",O,r(o.newSelectedproviderName)+" 配置",1)]),_:1}),e(C,null,{default:s(()=>[e(B,{iterable:o.newSelectedproviderConfig,metadata:o.metadata.provider_group.metadata,metadataKey:"provider"},null,8,["iterable","metadata"])]),_:1}),e(k,null,{default:s(()=>[e(U),e(u,{color:"blue-darken-1",variant:"text",onClick:_.newprovider,loading:o.loading},{default:s(()=>[i(" 保存 ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(u,{style:{"margin-top":"16px"},class:"flex-grow-1",variant:"tonal",size:"large",rounded:"lg",color:"gray",onClick:l[3]||(l[3]=a=>o.showConsole=!o.showConsole)},{default:s(()=>[e(w,null,{default:s(()=>[i("mdi-console-line")]),_:1}),i(" "+r(o.showConsole?"隐藏":"显示")+"日志 ",1)]),_:1}),o.showConsole?(n(),c("div",Q,[e(N,{style:{"background-color":"#000",height:"300px"}})])):x("",!0)]),_:1})]),_:1}),e(P,{timeout:3e3,elevation:"24",color:o.save_message_success,modelValue:o.save_message_snack,"onUpdate:modelValue":l[4]||(l[4]=a=>o.save_message_snack=a)},{default:s(()=>[i(r(o.save_message),1)]),_:1},8,["color","modelValue"]),e(D,{ref:"wfr"},null,512)],64)}const ne=G(H,[["render",Z]]);export{ne as default};
