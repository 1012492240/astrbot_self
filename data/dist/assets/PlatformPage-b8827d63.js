import{l as d,a5 as h,o as r,m as _,b as e,w as s,E as p,a9 as N,F as v,H as C,af as B,v as m,y as T,f as w,e as n,n as F,p as y,X as V,W as M,G as P,q as g,t as f,Y as k,J as U,K as A,U as x,D as I,g as W,c as S,j,h as z,ag as R,V as q}from"./index-11f1cd8c.js";import{A as E}from"./AstrBotConfig-568869c1.js";import{W as K}from"./WaitingForRestart-0476b659.js";import{_ as G}from"./ConsoleDisplayer-9b3eae3d.js";import{u as H}from"./common-34a2a7ab.js";import{_ as J}from"./_plugin-vue_export-helper-c27b6911.js";const X={name:"PlatformPage",components:{AstrBotConfig:E,WaitingForRestart:K,ConsoleDisplayer:G},data(){return{config_data:{},fetched:!1,metadata:{},showPlatformCfg:!1,newSelectedPlatformName:"",newSelectedPlatformConfig:{},updatingMode:!1,loading:!1,save_message_snack:!1,save_message:"",save_message_success:"",showConsole:!1,iframeLoading:!0,store:H()}},mounted(){this.getConfig()},methods:{refreshIframe(){this.iframeLoading=!0;const t=document.querySelector("iframe");console.log(t.src),t.src=t.src+"?t="+new Date().getTime()},getConfig(){d.get("/api/config/get").then(t=>{this.config_data=t.data.data.config,this.fetched=!0,this.metadata=t.data.data.metadata}).catch(t=>{this.save_message=t,this.save_message_snack=!0,this.save_message_success="error"})},addFromDefaultConfigTmpl(t){console.log(t),this.newSelectedPlatformName=t[0],this.showPlatformCfg=!0,this.updatingMode=!1,this.newSelectedPlatformConfig=this.metadata.platform_group.metadata.platform.config_template[t[0]]},newPlatform(){this.loading=!0,this.updatingMode?(d.post("/api/config/platform/update",{id:this.newSelectedPlatformName,config:this.newSelectedPlatformConfig}).then(t=>{this.loading=!1,this.showPlatformCfg=!1,this.getConfig(),this.$refs.wfr.check(),this.save_message=t.data.message,this.save_message_snack=!0,this.save_message_success="success"}).catch(t=>{this.loading=!1,this.save_message=t,this.save_message_snack=!0,this.save_message_success="error"}),this.updatingMode=!1):d.post("/api/config/platform/new",this.newSelectedPlatformConfig).then(t=>{this.loading=!1,this.showPlatformCfg=!1,this.getConfig(),this.save_message=t.data.message,this.save_message_snack=!0,this.save_message_success="success"}).catch(t=>{this.loading=!1,this.save_message=t,this.save_message_snack=!0,this.save_message_success="error"})},deletePlatform(t){d.post("/api/config/platform/delete",{id:t}).then(o=>{this.getConfig(),this.$refs.wfr.check(),this.save_message=o.data.message,this.save_message_snack=!0,this.save_message_success="success"}).catch(o=>{this.save_message=o,this.save_message_snack=!0,this.save_message_success="error"})},platformStatusChange(t){d.post("/api/config/platform/update",{id:t.id,config:t}).then(o=>{this.getConfig(),this.$refs.wfr.check(),this.save_message=o.data.message,this.save_message_snack=!0,this.save_message_success="success"}).catch(o=>{this.save_message=o,this.save_message_snack=!0,this.save_message_success="error"})}}},Y={class:"text-h4"},O=g("span",{style:{"font-size":"12px"}},"适配器类型: ",-1),Q={class:"text-h4"},Z=["src"],$={key:0,style:{"margin-top":"32px"}};function ee(t,o,se,te,a,c){const b=h("AstrBotConfig"),L=h("ConsoleDisplayer"),D=h("WaitingForRestart");return r(),_(v,null,[e(p,{style:{height:"100%"}},{default:s(()=>[e(C,{style:{padding:"32px",height:"100%"}},{default:s(()=>[e(B,null,{activator:s(({props:l})=>[e(m,T({class:"flex-grow-1",variant:"tonal",onClick:o[0]||(o[0]=i=>t.new_platform_dialog=!0),size:"large",rounded:"lg"},l,{color:"primary"}),{default:s(()=>[e(w,null,{default:s(()=>[n("mdi-plus")]),_:1}),n(" 新增平台适配器 ")]),_:2},1040)]),default:s(()=>[e(F,{"onUpdate:selected":o[1]||(o[1]=l=>c.addFromDefaultConfigTmpl(l))},{default:s(()=>[(r(!0),_(v,null,y(a.metadata.platform_group.metadata.platform.config_template,(l,i)=>(r(),S(j,{key:i,rounded:"xl",value:i},{default:s(()=>[e(z,null,{default:s(()=>[n(f(i),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})]),_:1}),e(V,{style:{"margin-top":"16px"}},{default:s(()=>[(r(!0),_(v,null,y(a.config_data.platform,(l,i)=>(r(),S(k,{key:i,cols:"12",md:"6",lg:"3"},{default:s(()=>[e(p,{class:"fade-in",style:{"margin-bottom":"16px","min-height":"250px","max-height":"250px",display:"flex","justify-content":"space-between","flex-direction":"column"}},{default:s(()=>[e(P,{class:"d-flex justify-space-between align-center"},{default:s(()=>[g("span",Y,f(l.id),1),e(R,{color:"primary","hide-details":"",density:"compact",modelValue:l.enable,"onUpdate:modelValue":[u=>l.enable=u,u=>c.platformStatusChange(l)]},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(C,null,{default:s(()=>[g("div",null,[O,e(q,{size:"small",color:"primary",text:""},{default:s(()=>[n(f(l.type),1)]),_:2},1024)])]),_:2},1024),e(x,{class:"d-flex justify-end"},{default:s(()=>[e(m,{color:"error",text:"",onClick:u=>{c.deletePlatform(l.id)}},{default:s(()=>[n(" 删除 ")]),_:2},1032,["onClick"]),e(m,{color:"blue-darken-1",text:"",onClick:u=>{a.updatingMode=!0,a.showPlatformCfg=!0,a.newSelectedPlatformConfig=l,a.newSelectedPlatformName=l.id}},{default:s(()=>[n(" 配置 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(M,{modelValue:a.showPlatformCfg,"onUpdate:modelValue":o[3]||(o[3]=l=>a.showPlatformCfg=l)},{default:s(()=>[e(p,null,{default:s(()=>[e(P,null,{default:s(()=>[g("span",Q,f(a.newSelectedPlatformName)+" 配置",1)]),_:1}),e(C,null,{default:s(()=>[e(V,null,{default:s(()=>[e(k,{cols:"12",md:"6"},{default:s(()=>[e(b,{iterable:a.newSelectedPlatformConfig,metadata:a.metadata.platform_group.metadata,metadataKey:"platform"},null,8,["iterable","metadata"])]),_:1}),e(k,{cols:"12",md:"6"},{default:s(()=>[e(m,{loading:a.iframeLoading,onClick:c.refreshIframe,variant:"tonal",color:"primary",style:{float:"right"}},{default:s(()=>[e(w,null,{default:s(()=>[n("mdi-refresh")]),_:1}),n(" 刷新 ")]),_:1},8,["loading","onClick"]),U(g("iframe",{src:a.store.getTutorialLink(a.newSelectedPlatformConfig.type),onLoad:o[2]||(o[2]=l=>a.iframeLoading=!1),style:{width:"100%",border:"none",height:"100%"}},`
                                `,40,Z),[[A,!a.iframeLoading]])]),_:1})]),_:1})]),_:1}),e(x,null,{default:s(()=>[e(I),e(m,{color:"blue-darken-1",variant:"text",onClick:c.newPlatform,loading:a.loading},{default:s(()=>[n(" 保存 ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(m,{style:{"margin-top":"16px"},class:"flex-grow-1",variant:"tonal",size:"large",rounded:"lg",color:"gray",onClick:o[4]||(o[4]=l=>a.showConsole=!a.showConsole)},{default:s(()=>[e(w,null,{default:s(()=>[n("mdi-console-line")]),_:1}),n(" "+f(a.showConsole?"隐藏":"显示")+"日志 ",1)]),_:1}),a.showConsole?(r(),_("div",$,[e(L,{style:{"background-color":"#000",height:"300px"}})])):W("",!0)]),_:1})]),_:1}),e(N,{timeout:3e3,elevation:"24",color:a.save_message_success,modelValue:a.save_message_snack,"onUpdate:modelValue":o[5]||(o[5]=l=>a.save_message_snack=l)},{default:s(()=>[n(f(a.save_message),1)]),_:1},8,["color","modelValue"]),e(D,{ref:"wfr"},null,512)],64)}const me=J(X,[["render",ee]]);export{me as default};
